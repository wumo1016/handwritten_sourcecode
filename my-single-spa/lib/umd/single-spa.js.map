{"version":3,"file":"single-spa.js","sources":["../../src/applications/app.helpers.js","../../src/applications/apps.js","../../src/start.js"],"sourcesContent":["// App statuses\r\nexport const NOT_LOADED = 'NOT_LOADED'\r\nexport const LOADING_SOURCE_CODE = 'LOADING_SOURCE_CODE'\r\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED'\r\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING'\r\nexport const NOT_MOUNTED = 'NOT_MOUNTED'\r\nexport const MOUNTING = 'MOUNTING'\r\nexport const MOUNTED = 'MOUNTED'\r\nexport const UPDATING = 'UPDATING'\r\nexport const UNMOUNTING = 'UNMOUNTING'\r\nexport const UNLOADING = 'UNLOADING'\r\nexport const LOAD_ERROR = 'LOAD_ERROR'\r\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN'\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 获取应用名\r\n * @param app\r\n */\r\nexport const toName = app => app.name\r\n","import { NOT_LOADED, toName } from './app.helpers'\r\n\r\nconst apps = []\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 注册应用\r\n * @param appNameOrConfig 应用名\r\n * @param appOrLoadApp 应用加载函数\r\n * @param activeWhen 应用加载时机\r\n * @param customProps 应用接收的数据\r\n */\r\nexport function registerApplication(\r\n  appNameOrConfig,\r\n  appOrLoadApp,\r\n  activeWhen,\r\n  customProps\r\n) {\r\n  // 格式化参数\r\n  const registration = sanitizeArguments(\r\n    appNameOrConfig, // string\r\n    appOrLoadApp, // function\r\n    activeWhen, // function\r\n    customProps\r\n  )\r\n\r\n  // 检查应用是否注册过\r\n  if (getAppNames().includes(registration.name))\r\n    throw new Error(\r\n      `There is already an app registered with name ${registration.name}`\r\n    )\r\n\r\n  // 加入到全局 apps 中去\r\n  apps.push(\r\n    Object.assign(\r\n      {\r\n        loadErrorTime: null,\r\n        status: NOT_LOADED,\r\n        parcels: {},\r\n        devtools: {\r\n          overlays: {\r\n            options: {},\r\n            selectors: []\r\n          }\r\n        }\r\n      },\r\n      registration\r\n    )\r\n  )\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 格式化参数\r\n * @param appNameOrConfig 应用名\r\n * @param appOrLoadApp 应用加载函数\r\n * @param activeWhen 应用加载时机\r\n * @param customProps 应用接收的数据\r\n */\r\nfunction sanitizeArguments(\r\n  appNameOrConfig,\r\n  appOrLoadApp,\r\n  activeWhen,\r\n  customProps\r\n) {\r\n  // 初始化默认值\r\n  const registration = {\r\n    name: null,\r\n    loadApp: null,\r\n    activeWhen: null,\r\n    customProps: null\r\n  }\r\n\r\n  // 如果第一个参数是一个对象 就直接使用第一个对象作为配置\r\n  if (typeof appNameOrConfig === 'object') {\r\n    validateRegisterWithConfig(appNameOrConfig)\r\n    const { name, app, activeWhen, customProps } = appNameOrConfig\r\n    Object.assign(registration, {\r\n      name,\r\n      loadApp: app,\r\n      activeWhen,\r\n      customProps\r\n    })\r\n  } else {\r\n    validateRegisterWithArguments(\r\n      appNameOrConfig,\r\n      appOrLoadApp,\r\n      activeWhen,\r\n      customProps\r\n    )\r\n    Object.assign(registration, {\r\n      name: appNameOrConfig,\r\n      loadApp: appOrLoadApp,\r\n      activeWhen,\r\n      customProps\r\n    })\r\n  }\r\n\r\n  // 格式化\r\n  Object.assign(registration, {\r\n    loadApp: sanitizeLoadApp(registration.loadApp),\r\n    activeWhen: sanitizeActiveWhen(registration.activeWhen),\r\n    customProps: registration.customProps || {}\r\n  })\r\n\r\n  return registration\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 验证传入的配置是否符合要求(对象配置)\r\n * @param config\r\n */\r\nfunction validateRegisterWithConfig(config) {\r\n  // 1.config不能是 数组 或 null\r\n  // 2.config只接受这四种属性 [\"name\", \"app\", \"activeWhen\", \"customProps\"]\r\n  // 3.name属性必须是 string 且 length > 0\r\n  // 4.app属性必须是 对象 或 函数\r\n  // 5.activeWhen属性比如是 字符串 或 函数 或 数组[字符串|函数]\r\n  // 6.customProp属性必须是 undefined 或 对象(非null或数组)\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 验证传入的配置是否符合要求(参数配置)\r\n * @param name 应用名\r\n * @param appOrLoadApp 应用加载函数\r\n * @param activeWhen 应用加载时机\r\n * @param customProps 应用接收的数据\r\n */\r\nfunction validateRegisterWithArguments(\r\n  name,\r\n  appOrLoadApp,\r\n  activeWhen,\r\n  customProps\r\n) {\r\n  // 1.name属性必须是 string 且 length > 0\r\n  // 2.appOrLoadApp 必须为真\r\n  // 3.activeWhen 必须是个函数\r\n  // 4.customProp属性必须是 undefined 或 对象(非null或数组)\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 将 loadApp 格式化为函数\r\n * @param loadApp 加载函数\r\n */\r\nfunction sanitizeLoadApp(loadApp) {\r\n  if (typeof loadApp !== 'function') return () => Promise.resolve(loadApp)\r\n  return loadApp\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion: 将 activeWhen 处理成一个函数 (location) => activeWhenArray.some((activeWhen) => activeWhen(location));\r\n * @param activeWhen 加载时机\r\n */\r\nfunction sanitizeActiveWhen(activeWhen) {\r\n  const activeWhenArray = Array.isArray(activeWhen) ? activeWhen : [activeWhen]\r\n  // todo 处理数组\r\n  return location => activeWhenArray.some(activeWhen => activeWhen(location))\r\n}\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion:\r\n */\r\nexport function getAppNames() {\r\n  return apps.map(toName)\r\n}\r\n","/**\r\n * @Descripttion: 启动应用\r\n * @param {*}\r\n */\r\nexport function start() {}\r\n"],"names":[],"mappings":";;;;;;EAAA;EACO,MAAM,UAAU,GAAG,aAAY;AAYtC;EACA;EACA;EACA;EACA;EACA;EACO,MAAM,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC;;ECjBjC,MAAM,IAAI,GAAG,GAAE;AACf;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,SAAS,mBAAmB;EACnC,EAAE,eAAe;EACjB,EAAE,YAAY;EACd,EAAE,UAAU;EACZ,EAAE,WAAW;EACb,EAAE;EACF;EACA,EAAE,MAAM,YAAY,GAAG,iBAAiB;EACxC,IAAI,eAAe;EACnB,IAAI,YAAY;EAChB,IAAI,UAAU;EACd,IAAI,WAAW;EACf,IAAG;AACH;EACA;EACA,EAAE,IAAI,WAAW,EAAE,CAAC,QAAQ,CAAC,YAAY,CAAC,IAAI,CAAC;EAC/C,IAAI,MAAM,IAAI,KAAK;EACnB,MAAM,CAAC,6CAA6C,EAAE,YAAY,CAAC,IAAI,CAAC,CAAC;EACzE,KAAK;AACL;EACA;EACA,EAAE,IAAI,CAAC,IAAI;EACX,IAAI,MAAM,CAAC,MAAM;EACjB,MAAM;EACN,QAAQ,aAAa,EAAE,IAAI;EAC3B,QAAQ,MAAM,EAAE,UAAU;EAC1B,QAAQ,OAAO,EAAE,EAAE;EACnB,QAAQ,QAAQ,EAAE;EAClB,UAAU,QAAQ,EAAE;EACpB,YAAY,OAAO,EAAE,EAAE;EACvB,YAAY,SAAS,EAAE,EAAE;EACzB,WAAW;EACX,SAAS;EACT,OAAO;EACP,MAAM,YAAY;EAClB,KAAK;EACL,IAAG;EACH,CAAC;AACD;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA,SAAS,iBAAiB;EAC1B,EAAE,eAAe;EACjB,EAAE,YAAY;EACd,EAAE,UAAU;EACZ,EAAE,WAAW;EACb,EAAE;EACF;EACA,EAAE,MAAM,YAAY,GAAG;EACvB,IAAI,IAAI,EAAE,IAAI;EACd,IAAI,OAAO,EAAE,IAAI;EACjB,IAAI,UAAU,EAAE,IAAI;EACpB,IAAI,WAAW,EAAE,IAAI;EACrB,IAAG;AACH;EACA;EACA,EAAE,IAAI,OAAO,eAAe,KAAK,QAAQ,EAAE;EAE3C,IAAI,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,gBAAe;EAClE,IAAI,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE;EAChC,MAAM,IAAI;EACV,MAAM,OAAO,EAAE,GAAG;EAClB,MAAM,UAAU;EAChB,MAAM,WAAW;EACjB,KAAK,EAAC;EACN,GAAG,MAAM;EAOT,IAAI,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE;EAChC,MAAM,IAAI,EAAE,eAAe;EAC3B,MAAM,OAAO,EAAE,YAAY;EAC3B,MAAM,UAAU;EAChB,MAAM,WAAW;EACjB,KAAK,EAAC;EACN,GAAG;AACH;EACA;EACA,EAAE,MAAM,CAAC,MAAM,CAAC,YAAY,EAAE;EAC9B,IAAI,OAAO,EAAE,eAAe,CAAC,YAAY,CAAC,OAAO,CAAC;EAClD,IAAI,UAAU,EAAE,kBAAkB,CAAC,YAAY,CAAC,UAAU,CAAC;EAC3D,IAAI,WAAW,EAAE,YAAY,CAAC,WAAW,IAAI,EAAE;EAC/C,GAAG,EAAC;AACJ;EACA,EAAE,OAAO,YAAY;EACrB,CAAC;AAmCD;EACA;EACA;EACA;EACA;EACA;EACA,SAAS,eAAe,CAAC,OAAO,EAAE;EAClC,EAAE,IAAI,OAAO,OAAO,KAAK,UAAU,EAAE,OAAO,MAAM,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC;EAC1E,EAAE,OAAO,OAAO;EAChB,CAAC;AACD;EACA;EACA;EACA;EACA;EACA;EACA,SAAS,kBAAkB,CAAC,UAAU,EAAE;EACxC,EAAE,MAAM,eAAe,GAAG,KAAK,CAAC,OAAO,CAAC,UAAU,CAAC,GAAG,UAAU,GAAG,CAAC,UAAU,EAAC;EAC/E;EACA,EAAE,OAAO,QAAQ,IAAI,eAAe,CAAC,IAAI,CAAC,UAAU,IAAI,UAAU,CAAC,QAAQ,CAAC,CAAC;EAC7E,CAAC;AACD;EACA;EACA;EACA;EACA;EACO,SAAS,WAAW,GAAG;EAC9B,EAAE,OAAO,IAAI,CAAC,GAAG,CAAC,MAAM,CAAC;EACzB;;ECzKA;EACA;EACA;EACA;EACO,SAAS,KAAK,GAAG;;;;;;;;;;;"}