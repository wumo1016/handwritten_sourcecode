{"version":3,"file":"single-spa.js","sources":["../../src/start.js","../../src/navigations/reroute.js","../../src/applications/app-helpers.js","../../src/applications/app.js"],"sourcesContent":["import { reroute } from './navigations/reroute'\r\n\r\nexport let started = false\r\n/**\r\n * @Descripttion: 挂载应用\r\n * @param {*}\r\n */\r\nexport function start() {\r\n  started = true\r\n  // 加载并挂载应用\r\n  reroute()\r\n}\r\n","import { getAppChanges } from '../applications/app'\r\nimport { started } from '../start'\r\n\r\n/**\r\n * @Author: wyb\r\n * @Descripttion:\r\n * @param {*}\r\n */\r\nexport function reroute() {\r\n  // 获取需要加载的应用\r\n  // 获取需要被挂载的应用\r\n  // 获取需要卸载的应用\r\n\r\n  const { appsToUnmount, appsToLoad, appsToMount } = getAppChanges()\r\n\r\n  console.log(appsToUnmount, appsToLoad, appsToMount)\r\n\r\n  if (started) {\r\n    // 调用start\r\n    return performAppChanges()\r\n  } else {\r\n    // 调用register\r\n    // 注册应用时 需要预先加载\r\n    return loadApps()\r\n  }\r\n}\r\n\r\n/**\r\n * @Descripttion: 根据路径来装载\r\n * @param {*}\r\n */\r\nasync function performAppChanges() {}\r\n\r\n/**\r\n * @Descripttion: 预加载应用\r\n * @param {*}\r\n */\r\nasync function loadApps() {}\r\n","// 描述应用的整个状态\r\nexport const NOT_LOADED = 'NOT_LOADED' // 应用初始状态\r\nexport const LOADING_SOURCE_CODE = 'LOADING_SOURCE_CODE' // 加载资源\r\nexport const NOT_BOOTSTRAPPED = 'NOT_BOOTSTRAPPED' // 还没有调用bootstrap方法\r\nexport const BOOTSTRAPPING = 'BOOTSTRAPPING' // 启动中\r\nexport const NOT_MOUNTED = 'NOT_MOUNTED' // 没有调用mount方法\r\nexport const MOUNTING = 'MOUNTING' // 正在挂载中\r\nexport const MOUNTED = 'MOUNTED' // 挂载完毕\r\nexport const UPDATINMG = 'UPDATINMG' // 更新中\r\nexport const UNMOUNTING = 'UNMOUNTING' // 解除挂载\r\nexport const UNLOADING = 'UNLOADING' // 完全卸载中\r\nexport const LOAD_ERR = 'LOAD_ERR' // 加载报错\r\nexport const SKIP_BECAUSE_BROKEN = 'SKIP_BECAUSE_BROKEN' // 执行报错\r\n\r\n// 当前应用是否被激活\r\nexport function isActive(app) {\r\n  return app.status === MOUNTED\r\n}\r\n\r\n// 当前这个应用是否要被激活 \r\n// 如果返回true 那么应用应该就开始初始化等一系列操作\r\nexport function shouldBeActive(app) {\r\n  return app.activeWhen(window.location)\r\n}\r\n ","import { reroute } from '../navigations/reroute'\r\nimport {\r\n  BOOTSTRAPPING,\r\n  LOADING_SOURCE_CODE,\r\n  MOUNTED,\r\n  NOT_BOOTSTRAPPED,\r\n  NOT_LOADED,\r\n  NOT_MOUNTED,\r\n  shouldBeActive\r\n} from './app-helpers'\r\n\r\nconst apps = []\r\n\r\n/**\r\n * @Descripttion: 注册应用\r\n * @param {*} appName 应用名\r\n * @param {*} loadApp 加载应用的方法\r\n * @param {*} activeWhen 何时调用 loadApp 方法\r\n * @param {*} customProps 自定义属性\r\n */\r\nexport function registerApplication(appName, loadApp, activeWhen, customProps) {\r\n  apps.push({\r\n    name: appName,\r\n    loadApp,\r\n    activeWhen,\r\n    customProps,\r\n    status: NOT_LOADED\r\n  })\r\n\r\n  reroute() // 加载应用\r\n\r\n  // console.log(apps)\r\n}\r\n\r\n/**\r\n * @Descripttion:\r\n * @param {*}\r\n */\r\nexport function getAppChanges() {\r\n  const appsToUnmount = [] // 需要卸载的app\r\n  const appsToLoad = [] // 需要加载的app\r\n  const appsToMount = [] // 需要挂载的app\r\n\r\n  apps.forEach(app => {\r\n    const appShouldBeActive = shouldBeActive(app) // 是否需要挂载\r\n    switch (app.status) {\r\n      case NOT_LOADED:\r\n      case LOADING_SOURCE_CODE:\r\n        if (appShouldBeActive) appsToLoad.push(app)\r\n        break\r\n      case NOT_BOOTSTRAPPED:\r\n      case BOOTSTRAPPING:\r\n      case NOT_MOUNTED:\r\n        if (appShouldBeActive) appsToMount.push(app)\r\n        break\r\n      case MOUNTED:\r\n        if (!appShouldBeActive) appsToUnmount.push(app)\r\n        break\r\n      default:\r\n        break\r\n    }\r\n  })\r\n  \r\n  return {\r\n    appsToUnmount,\r\n    appsToLoad,\r\n    appsToMount\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;EAEO,IAAI,OAAO,GAAG,MAAK;EAC1B;EACA;EACA;EACA;EACO,SAAS,KAAK,GAAG;EACxB,EAAE,OAAO,GAAG,KAAI;EAChB;EACA,EAAE,OAAO,GAAE;EACX;;ECRA;EACA;EACA;EACA;EACA;EACO,SAAS,OAAO,GAAG;EAC1B;EACA;EACA;AACA;EACA,EAAE,MAAM,EAAE,aAAa,EAAE,UAAU,EAAE,WAAW,EAAE,GAAG,aAAa,GAAE;AACpE;EACA,EAAE,OAAO,CAAC,GAAG,CAAC,aAAa,EAAE,UAAU,EAAE,WAAW,EAAC;AACrD;EACA,EAAE,IAAI,OAAO,EAAE;EACf;EACA,IAAI,OAAO,iBAAiB,EAAE;EAC9B,GAAG,MAAM;EACT;EACA;EACA,IAAI,OAAO,QAAQ,EAAE;EACrB,GAAG;EACH,CAAC;AACD;EACA;EACA;EACA;EACA;EACA,eAAe,iBAAiB,GAAG,EAAE;AACrC;EACA;EACA;EACA;EACA;EACA,eAAe,QAAQ,GAAG;;ECrC1B;EACO,MAAM,UAAU,GAAG,aAAY;EAC/B,MAAM,mBAAmB,GAAG,sBAAqB;EACjD,MAAM,gBAAgB,GAAG,mBAAkB;EAC3C,MAAM,aAAa,GAAG,gBAAe;EACrC,MAAM,WAAW,GAAG,cAAa;EAEjC,MAAM,OAAO,GAAG,UAAS;AAWhC;EACA;EACA;EACO,SAAS,cAAc,CAAC,GAAG,EAAE;EACpC,EAAE,OAAO,GAAG,CAAC,UAAU,CAAC,MAAM,CAAC,QAAQ,CAAC;EACxC;;ECZA,MAAM,IAAI,GAAG,GAAE;AACf;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACO,SAAS,mBAAmB,CAAC,OAAO,EAAE,OAAO,EAAE,UAAU,EAAE,WAAW,EAAE;EAC/E,EAAE,IAAI,CAAC,IAAI,CAAC;EACZ,IAAI,IAAI,EAAE,OAAO;EACjB,IAAI,OAAO;EACX,IAAI,UAAU;EACd,IAAI,WAAW;EACf,IAAI,MAAM,EAAE,UAAU;EACtB,GAAG,EAAC;AACJ;EACA,EAAE,OAAO,GAAE;AACX;EACA;EACA,CAAC;AACD;EACA;EACA;EACA;EACA;EACO,SAAS,aAAa,GAAG;EAChC,EAAE,MAAM,aAAa,GAAG,GAAE;EAC1B,EAAE,MAAM,UAAU,GAAG,GAAE;EACvB,EAAE,MAAM,WAAW,GAAG,GAAE;AACxB;EACA,EAAE,IAAI,CAAC,OAAO,CAAC,GAAG,IAAI;EACtB,IAAI,MAAM,iBAAiB,GAAG,cAAc,CAAC,GAAG,EAAC;EACjD,IAAI,QAAQ,GAAG,CAAC,MAAM;EACtB,MAAM,KAAK,UAAU,CAAC;EACtB,MAAM,KAAK,mBAAmB;EAC9B,QAAQ,IAAI,iBAAiB,EAAE,UAAU,CAAC,IAAI,CAAC,GAAG,EAAC;EACnD,QAAQ,KAAK;EACb,MAAM,KAAK,gBAAgB,CAAC;EAC5B,MAAM,KAAK,aAAa,CAAC;EACzB,MAAM,KAAK,WAAW;EACtB,QAAQ,IAAI,iBAAiB,EAAE,WAAW,CAAC,IAAI,CAAC,GAAG,EAAC;EACpD,QAAQ,KAAK;EACb,MAAM,KAAK,OAAO;EAClB,QAAQ,IAAI,CAAC,iBAAiB,EAAE,aAAa,CAAC,IAAI,CAAC,GAAG,EAAC;EACvD,QAAQ,KAAK;EAGb,KAAK;EACL,GAAG,EAAC;EACJ;EACA,EAAE,OAAO;EACT,IAAI,aAAa;EACjB,IAAI,UAAU;EACd,IAAI,WAAW;EACf,GAAG;EACH;;;;;;;;;;;"}